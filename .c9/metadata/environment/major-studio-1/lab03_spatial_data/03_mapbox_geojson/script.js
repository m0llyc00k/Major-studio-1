{"filter":false,"title":"script.js","tooltip":"/major-studio-1/lab03_spatial_data/03_mapbox_geojson/script.js","undoManager":{"mark":24,"position":24,"stack":[[{"start":{"row":91,"column":3},"end":{"row":91,"column":6},"action":"remove","lines":["   "],"id":6},{"start":{"row":91,"column":3},"end":{"row":92,"column":0},"action":"insert","lines":["",""]},{"start":{"row":92,"column":0},"end":{"row":93,"column":0},"action":"insert","lines":["",""]}],[{"start":{"row":93,"column":0},"end":{"row":184,"column":6},"action":"insert","lines":["// Requires your access token","","let objects","","// Loading geo.json features with dedicated d3 method        ","d3.json('africa.geo.json')","  .then((geojson) => {","    // Asynchronous JavaScript waiting for data promise to complete before moving on to .then() ","    if (geojson.features) {","      console.log('Number of features:', geojson.features.length)","      objects = geojson","    }","    // https://www.mapbox.com/mapbox-gl-js/api/#accesstoken","    // TODO: add personal mapbox access token","    mapboxgl.accessToken = 'pk.yourAccessToken'","","    // https://www.mapbox.com/mapbox-gl-js/api/#map","    let map = new mapboxgl.Map({","        container: 'map',","        style: 'mapbox://styles/mapbox/light-v9',  // try your own, i.e. mapbox://styles/sauter/cksi9buw56sk918mkg9c58qjf","        center: [18.2812, 9.1021], // 9.1021째 N, 18.2812째 E","        zoom: 2","    })","","    // select mapbox container ","    let container = map.getCanvasContainer()","    ","    //add svg","    let svg = d3.select(container).append('svg')","","    function projectPoint (lon, lat) {","        let point = map.project(new mapboxgl.LngLat(lon, lat))","        this.stream.point(point.x, point.y)","    }","","    let transform = d3.geoTransform({point: projectPoint}) ","    let path = d3.geoPath().projection(transform) // https://github.com/d3/d3-3.x-api-reference/blob/master/Geo-Paths.md","        ","    let featureElement = svg","        .selectAll('path')","        .data(geojson.features)","        // d3 data joins https://observablehq.com/@d3/selection-join","        .join('path')","        .attr('d', d3.geoPath().projection(transform))","        .attr('stroke', 'none')","        .attr('fill', 'lightgray')","        .attr('fill-opacity', 0.3)","        .on('mouseover', function (d) {","          // https://developer.mozilla.org/en-US/docs/Web/API/Event/srcElement","          console.log(d.srcElement.__data__)","          d3.select(this).attr('fill', 'dodgerblue')","          //we control name","          d3.select('#hover')","            .text(d.srcElement.__data__.properties.name + ' has a population of ' + (d.srcElement.__data__.properties.pop_est/1000000).toFixed(1) + ' Mio.')","          d3.select('#hover').attr('fill-opacity', 1)","        })","        .on('mouseout', function (d) {","          d3.select(this).attr('fill', 'lightgray')","          d3.select('#hover').attr('fill-opacity', 0)","        })","        .on('mousemove', (d) => {","          // console.log(d3.pointer(d))","          d3.select('#hover')","            .attr('x', () => { return d3.pointer(d)[0] + 20 })","            .attr('y', () => { return d3.pointer(d)[1] + 10 })","        })","    ","    // add hover label text        ","    svg.append('text')","        .attr('id', 'hover')","        ","    // sync map views and scales on reset","    let update = () => {","        featureElement.attr('d', path)","    }","","    // manage layer visibility during map interactions that change projection","    map.on('viewreset', update)","","    map.on('movestart', () => {","        svg.classed('hidden', true)","    })","","    map.on('rotate', () => {","        svg.classed('hidden', true)","    })","","    map.on('moveend', () => {","        update()","        svg.classed('hidden', false)","    })","})    "],"id":7}],[{"start":{"row":107,"column":28},"end":{"row":107,"column":46},"action":"remove","lines":["pk.yourAccessToken"],"id":8},{"start":{"row":107,"column":28},"end":{"row":107,"column":122},"action":"insert","lines":["pk.eyJ1IjoicmVhZHlsZXRzZ28iLCJhIjoiY2t0dTR2aGNjMXd3bDJubWgwcWwzcWJzMyJ9.4Qpfc2HBPT14KIrBhX0XGQ"]}],[{"start":{"row":0,"column":0},"end":{"row":92,"column":0},"action":"remove","lines":["// Requires your access token","","let objects","","// Loading geo.json features with dedicated d3 method        ","await d3.json('https://d2ad6b4ur7yvpq.cloudfront.net/naturalearth-3.3.0/ne_110m_admin_0_countries.geojson')","  .then((geojson) => {","    // Asynchronous JavaScript waiting for data promise to complete before moving on to .then() ","    if (geojson.features) {","      console.log('Number of features:', geojson.features.length)","      objects = geojson","    }","    // https://www.mapbox.com/mapbox-gl-js/api/#accesstoken","    // TODO: add personal mapbox access token","    mapboxgl.accessToken = 'pk.eyJ1IjoicmVhZHlsZXRzZ28iLCJhIjoiY2t0dTR2aGNjMXd3bDJubWgwcWwzcWJzMyJ9.4Qpfc2HBPT14KIrBhX0XGQ'","","    // https://www.mapbox.com/mapbox-gl-js/api/#map","    let map = new mapboxgl.Map({","        container: 'map',","        style: 'mapbox://styles/mapbox/light-v9',  // try your own, i.e. mapbox://styles/sauter/cksi9buw56sk918mkg9c58qjf","        center: [18.2812, 9.1021], // 9.1021째 N, 18.2812째 E","        zoom: 2","    })","","    // select mapbox container ","    let container = map.getCanvasContainer()","    ","    //add svg","    let svg = d3.select(container).append('svg')","","    function projectPoint (lon, lat) {","        let point = map.project(new mapboxgl.LngLat(lon, lat))","        this.stream.point(point.x, point.y)","    }","","    let transform = d3.geoTransform({point: projectPoint}) ","    let path = d3.geoPath().projection(transform) // https://github.com/d3/d3-3.x-api-reference/blob/master/Geo-Paths.md","        ","    let featureElement = svg","        .selectAll('path')","        .data(geojson.features)","        // d3 data joins https://observablehq.com/@d3/selection-join","        .join('path')","        .attr('d', d3.geoPath().projection(transform))","        .attr('stroke', 'none')","        .attr('fill', 'lightgray')","        .attr('fill-opacity', 0.3)","        .on('mouseover', function (d) {","          // https://developer.mozilla.org/en-US/docs/Web/API/Event/srcElement","          console.log(d.srcElement.__data__)","          d3.select(this).attr('fill', 'dodgerblue')","          //we control name","          d3.select('#hover')","            .text(d.srcElement.__data__.properties.name + ' has a population of ' + (d.srcElement.__data__.properties.pop_est/1000000).toFixed(1) + ' Mio.')","          d3.select('#hover').attr('fill-opacity', 1)","        })","        .on('mouseout', function (d) {","          d3.select(this).attr('fill', 'lightgray')","          d3.select('#hover').attr('fill-opacity', 0)","        })","        .on('mousemove', (d) => {","          // console.log(d3.pointer(d))","          d3.select('#hover')","            .attr('x', () => { return d3.pointer(d)[0] + 20 })","            .attr('y', () => { return d3.pointer(d)[1] + 10 })","        })","    ","    // add hover label text        ","    svg.append('text')","        .attr('id', 'hover')","        ","    // sync map views and scales on reset","    let update = () => {","        featureElement.attr('d', path)","    }","","    // manage layer visibility during map interactions that change projection","    map.on('viewreset', update)","","    map.on('movestart', () => {","        svg.classed('hidden', true)","    })","","    map.on('rotate', () => {","        svg.classed('hidden', true)","    })","","    map.on('moveend', () => {","        update()","        svg.classed('hidden', false)","    })","}) ",""],"id":9}],[{"start":{"row":6,"column":3},"end":{"row":6,"column":7},"action":"remove","lines":["json"],"id":14},{"start":{"row":6,"column":3},"end":{"row":6,"column":4},"action":"insert","lines":["c"]},{"start":{"row":6,"column":4},"end":{"row":6,"column":5},"action":"insert","lines":["s"]},{"start":{"row":6,"column":5},"end":{"row":6,"column":6},"action":"insert","lines":["v"]}],[{"start":{"row":6,"column":7},"end":{"row":6,"column":24},"action":"remove","lines":["'africa.geo.json'"],"id":15},{"start":{"row":6,"column":7},"end":{"row":6,"column":97},"action":"insert","lines":["https://d2ad6b4ur7yvpq.cloudfront.net/naturalearth-3.3.0/ne_110m_admin_0_countries.geojson"]}],[{"start":{"row":6,"column":7},"end":{"row":6,"column":8},"action":"insert","lines":["'"],"id":16}],[{"start":{"row":6,"column":98},"end":{"row":6,"column":99},"action":"insert","lines":["'"],"id":17}],[{"start":{"row":22,"column":14},"end":{"row":22,"column":15},"action":"remove","lines":["2"],"id":18}],[{"start":{"row":22,"column":14},"end":{"row":22,"column":15},"action":"insert","lines":["1"],"id":19}],[{"start":{"row":22,"column":15},"end":{"row":22,"column":16},"action":"insert","lines":["."],"id":20},{"start":{"row":22,"column":16},"end":{"row":22,"column":17},"action":"insert","lines":["5"]}],[{"start":{"row":22,"column":17},"end":{"row":22,"column":18},"action":"insert","lines":["5"],"id":21}],[{"start":{"row":21,"column":17},"end":{"row":21,"column":24},"action":"remove","lines":["18.2812"],"id":22},{"start":{"row":21,"column":17},"end":{"row":21,"column":18},"action":"insert","lines":["2"]},{"start":{"row":21,"column":18},"end":{"row":21,"column":19},"action":"insert","lines":["0"]}],[{"start":{"row":21,"column":18},"end":{"row":21,"column":19},"action":"remove","lines":["0"],"id":23},{"start":{"row":21,"column":17},"end":{"row":21,"column":18},"action":"remove","lines":["2"]}],[{"start":{"row":21,"column":17},"end":{"row":21,"column":18},"action":"insert","lines":["1"],"id":24},{"start":{"row":21,"column":18},"end":{"row":21,"column":19},"action":"insert","lines":["0"]}],[{"start":{"row":21,"column":26},"end":{"row":21,"column":27},"action":"remove","lines":["1"],"id":25},{"start":{"row":21,"column":25},"end":{"row":21,"column":26},"action":"remove","lines":["2"]},{"start":{"row":21,"column":24},"end":{"row":21,"column":25},"action":"remove","lines":["0"]},{"start":{"row":21,"column":23},"end":{"row":21,"column":24},"action":"remove","lines":["1"]},{"start":{"row":21,"column":22},"end":{"row":21,"column":23},"action":"remove","lines":["."]},{"start":{"row":21,"column":21},"end":{"row":21,"column":22},"action":"remove","lines":["9"]}],[{"start":{"row":21,"column":21},"end":{"row":21,"column":22},"action":"insert","lines":["1"],"id":26},{"start":{"row":21,"column":22},"end":{"row":21,"column":23},"action":"insert","lines":["5"]}],[{"start":{"row":21,"column":21},"end":{"row":21,"column":22},"action":"remove","lines":["1"],"id":27}],[{"start":{"row":21,"column":21},"end":{"row":21,"column":22},"action":"insert","lines":["2"],"id":28}],[{"start":{"row":54,"column":51},"end":{"row":54,"column":55},"action":"remove","lines":["name"],"id":29},{"start":{"row":54,"column":51},"end":{"row":54,"column":61},"action":"insert","lines":["sovereignt"]}],[{"start":{"row":6,"column":3},"end":{"row":6,"column":6},"action":"remove","lines":["csv"],"id":30},{"start":{"row":6,"column":3},"end":{"row":6,"column":4},"action":"insert","lines":["j"]},{"start":{"row":6,"column":4},"end":{"row":6,"column":5},"action":"insert","lines":["s"]},{"start":{"row":6,"column":5},"end":{"row":6,"column":6},"action":"insert","lines":["o"]},{"start":{"row":6,"column":6},"end":{"row":6,"column":7},"action":"insert","lines":["n"]}],[{"start":{"row":54,"column":51},"end":{"row":54,"column":61},"action":"remove","lines":["sovereignt"],"id":31},{"start":{"row":54,"column":51},"end":{"row":54,"column":52},"action":"insert","lines":["n"]},{"start":{"row":54,"column":52},"end":{"row":54,"column":53},"action":"insert","lines":["a"]},{"start":{"row":54,"column":53},"end":{"row":54,"column":54},"action":"insert","lines":["m"]},{"start":{"row":54,"column":54},"end":{"row":54,"column":55},"action":"insert","lines":["e"]}],[{"start":{"row":24,"column":0},"end":{"row":25,"column":0},"action":"insert","lines":["",""],"id":32},{"start":{"row":25,"column":0},"end":{"row":26,"column":0},"action":"insert","lines":["",""]},{"start":{"row":26,"column":0},"end":{"row":27,"column":0},"action":"insert","lines":["",""]}],[{"start":{"row":25,"column":0},"end":{"row":45,"column":13},"action":"insert","lines":[" /*** load data ***/","  async function loadData() {","    const airports = await d3.csv('data/all_month.csv');","","    // add markers to map","    airports.forEach(function(d) {","","    // create a HTML element for each feature","    var el = document.createElement('div');","    el.className = 'marker';","","    // make a marker for each feature and add to the map","    new mapboxgl.Marker(el)","      .setLngLat([d.longitude, d.latitude])","      .setPopup(new mapboxgl.Popup({ offset: 25 }) // add popups","      .setHTML('<h3>' + d.time + '</h3>'))","      .addTo(map);","    });","  }","","  loadData();"],"id":33}],[{"start":{"row":27,"column":39},"end":{"row":27,"column":40},"action":"remove","lines":["/"],"id":34},{"start":{"row":27,"column":38},"end":{"row":27,"column":39},"action":"remove","lines":["a"]},{"start":{"row":27,"column":37},"end":{"row":27,"column":38},"action":"remove","lines":["t"]},{"start":{"row":27,"column":36},"end":{"row":27,"column":37},"action":"remove","lines":["a"]},{"start":{"row":27,"column":35},"end":{"row":27,"column":36},"action":"remove","lines":["d"]}]]},"ace":{"folds":[],"scrolltop":286,"scrollleft":0,"selection":{"start":{"row":27,"column":35},"end":{"row":27,"column":35},"isBackwards":false},"options":{"guessTabSize":true,"useWrapMode":false,"wrapToView":true},"firstLineState":{"row":14,"state":"no_regex","mode":"ace/mode/javascript"}},"timestamp":1636326656287,"hash":"45ffe140bf6fe6d762bfdfdca4e597cdd3f4b96d"}